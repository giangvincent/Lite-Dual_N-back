<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Lite Dual N-back rebuilt with Vue 3">
  <title>Lite Dual N-back Version 1.0.0</title>
  <link rel="icon" type="image/png" href="legacy/favicon.png">
  <link rel="stylesheet" href="legacy/css/chartist.min.css">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div id="app" v-cloak>
    <button class="nav-toggle" @click="toggleNav" :aria-expanded="navOpen.toString()" aria-controls="settings-panel">
      <span class="nav-toggle-bar"></span>
      <span class="nav-toggle-bar"></span>
      <span class="nav-toggle-bar"></span>
    </button>

    <div class="app-shell" :class="{ 'nav-open': navOpen }">
      <aside id="settings-panel" class="settings-panel">
        <header class="panel-header">
          <h1>Lite Dual N-back</h1>
          <p class="panel-subtitle">Configure stimuli and feedback before you play.</p>
        </header>

        <section class="settings-group">
          <label class="slider-label" for="stimulus-time">Stimulus time <span>{{ settings.time }}ms</span></label>
          <input id="stimulus-time" type="range" min="2000" max="3000" step="250" v-model.number="settings.time">
        </section>

        <section class="settings-group">
          <label class="slider-label" for="matching-clues">Matching clues <span>{{ settings.clues }}</span></label>
          <input id="matching-clues" type="range" min="6" max="24" step="2" v-model.number="settings.clues">
        </section>

        <section class="settings-group">
          <label class="slider-label" for="n-level">N-back level <span>{{ settings.level }}</span></label>
          <input id="n-level" type="range" min="1" max="10" step="1" v-model.number="settings.level">
        </section>

        <section class="settings-group">
          <label class="slider-label" for="sound-set">Sounds</label>
          <select id="sound-set" v-model="settings.soundSet">
            <option v-for="option in soundOptions" :key="option" :value="option">{{ option }}</option>
          </select>
        </section>

        <section class="settings-group">
          <label class="slider-label" for="feedback-toggle">Clue feedback <span>{{ feedbackLabel }}</span></label>
          <input id="feedback-toggle" type="range" min="0" max="1" step="1" v-model.number="settings.feedback">
        </section>

        <section class="settings-group instructions">
          <h2>Controls</h2>
          <p>`A` for visual • `L` for audio • `S` to start / stop</p>
        </section>
      </aside>

      <main class="play-area">
        <div class="status-bar">
          <button class="chart-button" @click="openChart" title="Training history">★</button>
          <div class="stimuli-counter" :aria-live="running ? 'polite' : 'off'">{{ stimuliRemaining }}</div>
          <div class="progress-track" role="progressbar" aria-label="Daily progress" :aria-valuenow="progressPercent.toFixed(0)" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar" :style="{ width: progressPercent + '%' }"></div>
          </div>
        </div>

        <div class="grid" role="grid" aria-label="Dual N-back grid">
          <div v-for="index in 9" :key="index" role="gridcell" class="grid-cell" :class="tileClasses(index - 1)">
            <span v-if="index - 1 === 4" class="grid-center">N = {{ settings.level }}</span>
          </div>
        </div>

        <div class="controls">
          <button class="engine-button" @click="toggleGame">{{ running ? 'Stop' : 'Play' }}</button>
          <div class="action-buttons">
            <button class="action-button" :class="buttonClasses.visual" @click="confirmInput('position')">Visual</button>
            <button class="action-button" :class="buttonClasses.audio" @click="confirmInput('sound')">Audio</button>
          </div>
        </div>
      </main>
    </div>

    <transition name="fade">
      <section v-if="showResults" class="overlay" role="dialog" aria-modal="true">
        <div class="overlay-content">
          <button class="overlay-close" @click="closeResults" aria-label="Close results">✖</button>
          <h2 class="overlay-title">Round Summary</h2>
          <div class="results-table">
            <table>
              <thead>
                <tr>
                  <th colspan="2">Positions</th>
                  <th colspan="2">Sounds</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>☑</td><td>{{ resultsData.positions.hits }}</td>
                  <td>☑</td><td>{{ resultsData.sounds.hits }}</td>
                </tr>
                <tr>
                  <td>☐</td><td>{{ resultsData.positions.misses }}</td>
                  <td>☐</td><td>{{ resultsData.sounds.misses }}</td>
                </tr>
                <tr>
                  <td>☒</td><td>{{ resultsData.positions.errors }}</td>
                  <td>☒</td><td>{{ resultsData.sounds.errors }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <p class="overlay-message">{{ resultsData.message }}</p>
        </div>
      </section>
    </transition>

    <transition name="fade">
      <section v-if="showChart" class="overlay" role="dialog" aria-modal="true">
        <div class="overlay-content">
          <button class="overlay-close" @click="closeChart" aria-label="Close chart">✖</button>
          <h2 class="overlay-title">Training History</h2>
          <div class="chart-container">
            <div :id="chartContainerId" class="ct-chart ct-major-tenth"></div>
          </div>
        </div>
      </section>
    </transition>
  </div>

  <script src="legacy/js/howler.min.js"></script>
  <script src="legacy/js/chartist.min.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="scripts/app.js"></script>
</body>
</html>
